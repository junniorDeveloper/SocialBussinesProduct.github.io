<!DOCTYPE html>
<html lang="es">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Sistemas</title>

  <!-- LINK DE ESTILOS CSS -->
  <link rel="stylesheet" href="src/style/main.css">

  <!-- LINK DE ESTILOS TAILWIND -->
  <script src="https://cdn.tailwindcss.com"></script>

  <!-- LINK DE ESTILOS BOOTSTRAP -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet"
    integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
  
  <!-- SWEET ALERT -->
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

  <!-- LINK DE ICONS -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css">

  <style>
    .table-with{
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
      max-width: 200px;
    }
  </style>
</head>

<body class="bg-gray-100 p-6">

  <div class="container mx-auto">

    <!-- DIV CARD NOMBRE DE SISTEMA -->
    <div class="flex items-center justify-between bg-white mb-4 rounded-lg shadow-md px-4 py-3">
      <h1 id="page-title" class="font-semibold text-gray-700  sm:text-sm md:text-lg">Inventario de Productos</h1>
    </div>

    <!-- DIV CARD PANEL CONTROL - TABLA -->
    <div class="bg-white shadow-md rounded-lg p-4">

      <!-- DIV CARD SOLO PANEL CONTROL -->
      <div class="flex flex-col lg:flex-row justify-between items-stretch gap-4 border pb-4 mb-6 bg-white shadow-md rounded-lg p-4">

        <!-- CONTENT IZQUIERDA -->
        <div class="flex flex-col sm:flex-row gap-2 sm:gap-4 w-full lg:w-auto">

          <!-- FILTRO DE BUSQUEDA -->
          <input type="text" id="searchInput" placeholder="Filtro de Búsqueda..."
          class="flex-grow min-w-[150px] border border-gray-300 rounded-md p-2 text-gray-700 focus:outline-none focus:ring-2 focus:ring-blue-500 transition duration-200 btn-custom"/>

          <!-- BOTON CATEGORIA -->
          <div class="dropdown whitespace-nowrap">
            <button class="btn btn-light border dropdown-toggle px-4 py-2 text-sm w-full btn-custom" type="button"
              data-bs-toggle="dropdown" aria-expanded="false">
              <i class="fa-solid fa-th-large me-2"></i> Categorías
            </button>
            <ul class="dropdown-menu text-sm w-full" id="categoryFilter">
              <li><a class="dropdown-item" data-category="all"><i class="fa-solid fa-list me-2"></i> Todas</a></li>
              <li><a class="dropdown-item" data-category="exploradoras"><i class="fa-solid fa-lightbulb me-2"></i> Exploradoras</a></li>
              <li><a class="dropdown-item" data-category="focos"><i class="fa-solid fa-sun me-2"></i> Focos</a></li>
              <li><a class="dropdown-item" data-category="herrajes"><i class="fa-solid fa-tools me-2"></i> Herrajes</a></li>
              <li><a class="dropdown-item" data-category="indumentaria"><i class="fa-solid fa-tshirt me-2"></i> Indumentaria</a></li>
              <li><a class="dropdown-item" data-category="cascos"><i class="fa-solid fa-hard-hat me-2"></i> Cascos</a></li>
              <li><a class="dropdown-item" data-category="accesorios"><i class="fa-solid fa-puzzle-piece me-2"></i> Accesorios</a></li>
              <li><a class="dropdown-item" data-category="inoxidable"><i class="fa-solid fa-industry me-2"></i> Inoxidables</a></li>
              <li><a class="dropdown-item" data-category="espejos"><i class="fa-solid fa-eye me-2"></i> Espejos</a></li>
              <li><a class="dropdown-item" data-category="protectores"><i class="fa-solid fa-shield-alt me-2"></i> Protectores</a></li>
              <li><a class="dropdown-item" data-category="stickers"><i class="fa-solid fa-sticky-note me-2"></i> Stickers</a></li>
            </ul>
          </div>

        </div>


        <!-- CONTENT DERECHA -->
        <div class="flex flex-col sm:flex-row gap-2 sm:gap-4 w-full lg:w-auto">


          <!-- BOTON ESTADO -->
          <div class="dropdown w-full">
            <button class="btn btn-light border dropdown-toggle px-4 py-2 text-sm w-full btn-custom" type="button"
              data-bs-toggle="dropdown" aria-expanded="false">
              <i class="fas fa-dot-circle me-2"></i> Sección
            </button>
            <ul class="dropdown-menu text-sm w-full" id="sectionFilter">
              <li type="button"><a class="dropdown-item" data-section="all">
                <i class="fa-solid fa-list me-2"></i> Todos
              </a></li>
              <li type="button"><a class="dropdown-item" data-section="indefinido">
                <i class="fa-solid fa-info-circle me-2"></i> Indefinido
              </a></li>
              <li type="button"><a class="dropdown-item" data-section="destacado">
                <i class="fa-solid fa-star me-2"></i> Destacados
              </a></li>
              <li type="button"><a class="dropdown-item" data-section="nuevos">
                <i class="fa-solid fa-newspaper me-2"></i> Nuevos Ingresos
              </a></li>
              <li type="button"><a class="dropdown-item" data-section="ofertas">
                <i class="fa-solid fa-tag me-2"></i> Ofertas
              </a></li>
              <li type="button"><a class="dropdown-item" data-section="temporada">
                <i class="fa-solid fa-calendar-alt me-2"></i> Temporada
              </a></li>
              <li type="button"><a class="dropdown-item" data-section="festividad">
                <i class="fa-solid fa-glass-cheers me-2"></i> Festividad
              </a></li>
            </ul>
          </div>

          <!-- BOTÓN STOCK -->
          <div class="dropdown w-full">
            <button class="btn btn-light border dropdown-toggle px-4 py-2 text-sm w-full btn-custom" type="button"
              data-bs-toggle="dropdown" aria-expanded="false">
              <i class="fa-solid fa-layer-group me-2"></i> Estado Stock
            </button>
            <ul class="dropdown-menu text-sm w-full" id="stockFilter">
              <li><a class="dropdown-item" data-stock="all">
                  <i class="fa-solid fa-list me-2"></i> Todos</a>
              </li>
              <li><hr class="dropdown-divider"></li>
              <li><a class="dropdown-item" data-stock="Disponible">
                  <i class="fa-solid fa-check-circle me-2"></i> Disponible</a>
              </li>
              <li><a class="dropdown-item" data-stock="Limitado">
                  <i class="fa-solid fa-exclamation-triangle me-2"></i>Limitado</a>
              </li>
              <li><a class="dropdown-item" data-stock="Agotado">
                  <i class="fa-solid fa-times-circle me-2"></i> Agotado</a>
              </li>
            </ul>
          </div>

          <!-- BOTON REGISTRAR Y LISTA DE ACTIVOS INCATIVOS -->
          <div class="btn-group">
            <button  id="openModal" type="button" class="btn btn-light border w-full btn-custom">Registrar</button>
            <button type="button" class="btn btn-light border  dropdown-toggle dropdown-toggle-split" data-bs-toggle="dropdown" aria-expanded="false" data-bs-reference="parent">
              <span class="visually-hidden">Toggle Dropdown</span>
            </button>
            <ul class="dropdown-menu text-sm w-full">
              <li type="button"><a class="dropdown-item" onclick="fetchProducts('/active', 'Activos')">
                  <i class="fas fa-toggle-on me-2"></i>Ver Activos</a>
              </li>
              <li type="button"><a class="dropdown-item" onclick="fetchProducts('/inactive', 'Inactivos')">
                  <i class="fas fa-toggle-off me-2"></i>Ver Inactivos</a>
              </li>
            </ul>
          </div>

        </div>

      </div>

      <!-- LISTADO TABLA -->
      <div class="overflow-x-auto bg-white shadow-md rounded-lg">
        <table class="min-w-full text-sm text-left text-gray-700">
          <thead class="bg-gray-200 text-xs uppercase font-semibold">
            <tr>
              <th class="px-4 py-2  bg-gray-200 sticky left-0 z-10">Imagen</th>
              <th class="px-4 py-2 table-with">Nombre</th>
              <th class="px-4 py-2 table-with">Marca</th>
              <th class="px-4 py-2 table-with">Categoría</th>
              <th class="px-4 py-2 table-with">Section</th>
              <th class="px-4 py-2 table-with hidden md:table-cell">Precio Regular</th>
              <th class="px-4 py-2 table-with w-48">Precio Final</th>
              <th class="px-4 py-2 table-with">Stock</th>
              <th class="px-4 py-2 table-with hidden md:table-cell">Mensaje</th>
              <th class="px-4 py-2">Acciones</th>
            </tr>
          </thead>
          <tbody id="products-table-body">
            <!-- Aquí se insertan los productos dinámicamente -->
          </tbody>
        </table>
      </div>

    </div>
  </div>

  <!-- API -->
  <script>
    const BASE_API_URL = 'https://social-bussines-back.vercel.app/api/products';
  </script>

  <!-- LISTADO DE PRODUCTOS -->
  <script src="src/components/ListProducts/getProduct.js"></script>

  
  <!-- MODAL CREAR PRODUCTO - RUTA src/components/CreateProducts/postProduct.html -->
  <div id="ModalCrear"></div>

  <script>
    fetch("src/components/CreateProducts/postProduct.html")
      .then(res => res.text())
      .then(html => {
        const container = document.getElementById("ModalCrear");
        container.innerHTML = html;

        // Evalúa los <script> del contenido cargado
        const scripts = container.querySelectorAll("script");
        scripts.forEach(script => {
          const newScript = document.createElement("script");
          newScript.textContent = script.textContent;
          document.body.appendChild(newScript);
        });
      });
  </script>

    
  <!-- MODAL EDITAR PRODUCTO - RUTA src/components/EditProducts/putProduct.html -->
  <div id="ModalEditar"></div>

  <script>
    fetch("src/components/EditProducts/putProduct.html")
      .then(res => res.text())
      .then(html => {
        const container = document.getElementById("ModalEditar");
        container.innerHTML = html;

        // Evalúa los <script> del contenido cargado
        const scripts = container.querySelectorAll("script");
        scripts.forEach(script => {
          const newScript = document.createElement("script");
          newScript.textContent = script.textContent;
          document.body.appendChild(newScript);
        });
      });
  </script>


  <!-- MODAL VISTAPREVIA - RUTA src/components/PreviewProducts/previewProduct.html -->
  <div id="previewModalContainer"></div>

  <script>
    async function showPreviewModal(index) {
      const product = allProducts[index];

      const response = await fetch('src/components/PreviewProducts/previewProduct.html');
      const html = await response.text();
      document.getElementById('previewModalContainer').innerHTML = html;

       // Setea los datos del producto en los campos de entrada
        document.getElementById('previewImage').src =
            `https://qiziyaqqptpwcarbywsx.supabase.co/storage/v1/object/public/imagenes/products/${product.image}`;
        document.getElementById('previewName').value = product.name;
        document.getElementById('previewBrand').value = product.brand;
        document.getElementById('previewCategory').value = product.category;
        document.getElementById('previewSection').value = product.section;
        document.getElementById('previewDescription').value = product.description;
        document.getElementById('previewPrice').value = product.price.toFixed(2);
        document.getElementById('previewPriceEnd').value = product.price_end.toFixed(2);
        document.getElementById('previewStock').value = product.stock;
        document.getElementById('previewStockMsg').value = product.message_stock;
        // Muestra el modal
        document.getElementById('previewModal').classList.remove('hidden');
        // Desactivar scroll del fondo
        document.body.style.overflow = 'hidden';
    }

    function closePreviewModal() {
        document.getElementById('previewModal').classList.add('hidden');

        // Restaurar scroll del fondo
        document.body.style.overflow = 'auto';
    }
  </script>


  
  <!-- SCRIPT DE BOOTSTRAP -->
  <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.9.2/dist/umd/popper.min.js"
    integrity="sha384-IQsoLXl5PILFhosVNubq5LC7Qb9DXgDA9i+tQ8Zj3iwWAwPtgFTxbJ8NT4GN1R8p"
    crossorigin="anonymous"></script>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.min.js"
    integrity="sha384-cVKIPhGWiC2Al4u+LWgxfKTRIcfu0JTxR+EQDz/bgldoEyl4H0zUF0QKbrJ0EcQF"
    crossorigin="anonymous"></script>

</body>

</html>