<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
</head>
<body>
    
<!-- MODAL DE REGISTRO DE PRODUCTO (RESPONSIVO) -->
<div id="modal" class="fixed inset-0 bg-gray-900 bg-opacity-50 flex justify-center items-center z-50 hidden px-4">
  <div class="bg-white p-6 rounded-lg shadow-lg w-full max-w-screen-lg max-h-[90vh] overflow-y-auto">
    <h2 class="text-lg font-semibold mb-4">Registrar Producto</h2>

    <form>
      <div class="grid grid-cols-1 md:grid-cols-2 gap-4 p-4 bg-gray-50 rounded-lg shadow-sm">
        
        <div class="mb-2">
          <label class="form-label text-muted d-flex align-items-center mb-1">
            <i class="fas fa-box ml-2 me-2"></i> Nombre del Producto
          </label>
          <input type="text" name="name"
            class="form-control w-full border rounded focus:outline-none focus:ring-2 focus:ring-blue-300" required>
        </div>

        <div class="mb-2">
          <label class="form-label text-muted d-flex align-items-center mb-1">
            <i class="fas fa-briefcase ml-2 me-2"></i> Marca
          </label>
          <input type="text" name="brand"
            class="form-control w-full border rounded focus:outline-none focus:ring-2 focus:ring-blue-300" required>
        </div>

        <div class="mb-2 md:col-span-2">
          <label class="form-label text-muted d-flex align-items-center mb-1">
            <i class="fas fa-align-left ml-2 me-2"></i> Descripción
          </label>
          <textarea name="description"
            class="form-control w-full border rounded focus:outline-none focus:ring-2 focus:ring-blue-300" required
            rows="3" placeholder="Describe el producto..."></textarea>
        </div>

        <div class="mb-2">
          <label class="form-label text-muted d-flex align-items-center mb-1">
            <i class="fas fa-image ml-2 me-2"></i> Imagen
          </label>
          <input type="file" name="image"
            accept="image/*"
            class="form-control w-full border rounded focus:outline-none focus:ring-2 focus:ring-blue-300" required>
        </div>

        <div class="mb-2 d-flex flex-column flex-md-row justify-content-between align-items-start">
          <div class="w-100 w-md-50 me-md-2 mb-2 mb-md-0">
              <label class="form-label text-muted d-flex align-items-center mb-1">
                  <i class="fas fa-tags ml-2 me-2"></i> Categoría
              </label>
              <select name="category" class="form-control w-full border rounded focus:outline-none focus:ring-2 focus:ring-blue-300" required>
                  <option value="" disabled selected>Selecciona una categoría</option>
                  <option value="exploradoras">Exploradoras</option>
                  <option value="focos">Focos</option>
                  <option value="herrajes">Herrajes</option>
                  <option value="indumentaria">Indumentaria</option>
                  <option value="cascos">Cascos</option>
                  <option value="accesorios">Accesorios</option>
                  <option value="inoxidable">Inoxidables</option>
                  <option value="espejos">Espejos</option>
                  <option value="protectores">Protectores</option>
                  <option value="stickers">Stickers</option>
              </select>
          </div>

          <div class="w-100 w-md-50 ms-md-2">
              <label class="form-label text-muted d-flex align-items-center mb-1">
                  <i class="fas fa-tags ml-2 me-2"></i> Secciones
              </label>
              <select name="section" class="form-control w-full border rounded focus:outline-none focus:ring-2 focus:ring-blue-300" required>
                  <option value="" disabled selected>Selecciona una opción</option>
                  <option value="indefinido">Indefinido</option>
                  <option value="destacado">Destacado</option>
                  <option value="nuevos">Nuevos Ingresos</option>
                  <option value="ofertas">Ofertas</option>
                  <option value="temporada">Temporada</option>
                  <option value="festividad">Festividad</option>
              </select>
          </div>
        </div>

        <div class="mb-2">
          <label class="form-label text-muted d-flex align-items-center mb-1">
            <i class="fas fa-dollar-sign ml-2 me-2"></i> Precio Inicio
          </label>
          <input type="number" step="0.5" name="price"  min="0"
            class="form-control w-full border rounded focus:outline-none focus:ring-2 focus:ring-blue-300" required>
        </div>

        <div class="mb-2">
          <label class="form-label text-muted d-flex align-items-center mb-1">
            <i class="fas fa-money-bill ml-2 me-2"></i> Precio Final
          </label>
          <input type="number" step="0.5" name="price_end"  min="0"
            class="form-control w-full border rounded focus:outline-none focus:ring-2 focus:ring-blue-300" required>
        </div>

        <div class="mb-2">
          <label class="form-label text-muted d-flex align-items-center mb-1">
            <i class="fas fa-boxes ml-2 me-2"></i> Stock
          </label>
          <input type="number" name="stock"
            class="form-control w-full border rounded focus:outline-none focus:ring-2 focus:ring-blue-300" required>
        </div>

        <div class="mb-2">
          <label class="form-label text-muted d-flex align-items-center mb-1">
            <i class="fas fa-exclamation-circle ml-2 me-2"></i> Mensaje de Stock
          </label>
          <select name="message_stock" class="form-control w-full border rounded focus:outline-none focus:ring-2 focus:ring-blue-300" required>
            <option value="" disabled selected>Selecciona una opción</option>
              <option value="Disponible">Disponible</option>
              <option value="Limitado">Limitado</option>
              <option value="Agotado">Agotado</option>
          </select>
        </div>
      </div>

      <!-- Botones -->
      <div class="flex flex-col md:flex-row justify-end mt-4 space-y-2 md:space-y-0 md:space-x-2">
        <button type="button" id="closeModal" class="px-4 py-2 bg-gray-500 text-white rounded">
          Cancelar
        </button>
        <button type="submit" class="px-4 py-2 bg-green-500 text-white rounded hover:bg-green-600">
          Guardar
        </button>
      </div>
    </form>
  </div>
</div>

<script>
  // Este script corre al insertar el componente dinámicamente
  document.getElementById('openModal').addEventListener('click', function () {
    document.getElementById('modal').classList.remove('hidden');

    // Desactivar scroll del fondo
    document.body.style.overflow = 'hidden';
  });

  document.getElementById('closeModal').addEventListener('click', function () {
    document.getElementById('modal').classList.add('hidden');
    form.reset();

    // Restaurar scroll del fondo
    document.body.style.overflow = 'auto';
  });


  const form = document.querySelector('form');

  form.addEventListener('submit', async (e) => {
    e.preventDefault();

    const formData = new FormData(form); // esto incluye también la imagen

    try {
      const response = await fetch(BASE_API_URL, {
        method: 'POST',
        body: formData
      });

      if (!response.ok) throw new Error('Error al registrar producto');

      const data = await response.json();
      // SweetAlert de éxito
      await Swal.fire({
        icon: 'success',
        title: '¡Producto registrado!',
        text: 'El producto se registró correctamente.',
        confirmButtonColor: '#3085d6'
      });

      form.reset();
      document.getElementById('modal').classList.add('hidden');
      fetchProducts();

    } catch (error) {
      console.error(error);
      // SweetAlert de error
      Swal.fire({
        icon: 'error',
        title: 'Error',
        text: 'Hubo un problema al registrar el producto.',
        confirmButtonColor: '#d33'
      });
    }
  });

</script>

</body>
</html>